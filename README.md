# Задача:
Собрать макет создания Prediction Market контракта, который позволяет поиграть в игру да/нет, делая ставки друг против друга на определенном рынке (маркете). Победитель забирает свои ставки и ставки проигравших в качестве выигрыша.
Задача состоит из 4 простых шагов, каждый из которых проверяет базовый функционал. Дизайн и стилизация по вкусу.

#### Необходимо и достаточно:
1. Подключение кошелька - *база для работы с контрактом*:
Возможность подключить свой web3 кошелек, чтобы перейти к основным функциям dApp. 
Рекомендуем использовать [Rainbowkit](https://www.rainbowkit.com/docs/introduction)

    Далее будем работать с контрактом `PredictionMarketFactory` по адресу:
- [`0x595A74DDE1b1d08a48943A81602bc334474ce487`](https://mumbai.polygonscan.com/address/0x595A74DDE1b1d08a48943A81602bc334474ce487#code)
По ссылке можно посмотреть верифицированный контракт на Polygonscan и его функции в Read/Write Contract вкладках.
Если нужны тестовые токены для запросов - ссылки внизу страницы. 

2. Поиск маркета по входным данным - *read вызов контракта*:
Делаем базовую форму создания из 4 полей и кнопки "Create". 
Поля:
  - `cutoffDate`: number - дата, до которой можно делать ставки
  - `decisionDate`: number - дата, когда будет принято решение
  - `decisionProvider`: address - адрес контракта, который будет принимать решение (можно любой)
  - `description`: "text e.g. flight number etc" - описание маркета
Пользователь вводит данные на вход и мы осуществляем поиск ранее созданного маркета с такими данными отправляя view вызов в контракт-фабрику `getMarket(cutoffDate, description)`. 
Если маркет найден, то отображаем попап/алерт -> его адрес и соообщение формата "Market already exists".
Если маркет не найден, то переходим к пункту 3.

3. Создание нового маркета (`createMarket`) - *отправка Transaction*:
Теперь мы знаем, что маркета с такими параметрами еще нет и можем создать новый маркет, отправив транзакцию в контракт-фабрику `createMarket(cutoffDate, decisionDate, decisionProvider, description)`. Предварительно создание можно попробовать по ссылке выше в Write Contract вкладке.
Необходимо дождаться завершения транзакции и отобразить попап/алерт с сообщением формата "Market created successfully".

4. Отображение списка всех маркетов - *работа с REST API*:
После создания маркета мы можем отобразить список всех маркетов, которые есть в базе. 
Для этого используем REST API. Необходимо сделать базовый GET запрос на получение всех маркетов и отобразить их в виде списка (сортировать по lastEventDate). 
Backend url: https://emp-backend-test.fly.dev
Доки: https://emp-backend-test.fly.dev/docs (см. `GET /markets`)

##### Опционально, если будет интересно продолжить:
- Открывать детальное описание маркета по клику с описанием и статусом маркета (см. view методы контракта ниже)
- Открывать уже существующий маркет после поиска, если view возвращает адрес
- Получать адрес только что созданного маркета из логов транзакции и открывать его после создания (см. `marketCreatedEvent` в контракте ниже)
- Возможность сделать bet транзакцию (см. `bet` в контракте ниже)

### Полезная информация (в основном для доп. пунктов):
##### Backend, с которым можно взаимодействовать:
https://emp-backend-test.fly.dev
Сервер слушает events контракта и записывает все изменения к себе в базу.
Может отдать данные по известным маркетам и данные по ставкам у маркета.
Сами вызовы к контракту и запрос view методов осуществляются напрямую из dApp.
Доки:
https://emp-backend-test.fly.dev/docs

##### Контракты
Есть контракт-фабрика, который умеет создавать новые маркеты по заданным параметрам
Также этот контракт умеет проверять по view методу `getMarket(cutoffDate, description)`, если такой маркет уже зареган и отдавать его адрес

Есть сам контракт `PredictionMarket`, его функции:
- `bet` -> возможность сделать ставку, пока маркет еще открыт (state 0) и cutoffDate еще не прошла
- `provideResult` -> тот, кто при создании был указан как `DecisionMaker`, может закрыть маркет после decisionDate и передать true/false результат этого маркета
- `claim` -> тот, кто делал ставку может забрать свой выигрыш передав withdrawTo адрес
Контракт проверяет условия победы и перечисляет указанному адресу банк победителя

Адрес фабрики:
- [`0x595A74DDE1b1d08a48943A81602bc334474ce487`](https://mumbai.polygonscan.com/address/0x595A74DDE1b1d08a48943A81602bc334474ce487#code)
Передаем в `createMarket` параметры:
  `cutoffDate`: number
  `decisionDate`: number
  `decisionProvider`: address
  `description`: "text e.g. flight number etc"

Далее в ивентах контракта ждем `marketCreatedEvent`
Забираем `marketAddress` или `topic1` (идентично)

Пример верифицированного Prediction Market с доступными view методами: 
[`0x08D85979eb7c04D7f339036BC87a8d850BE29b92`](https://mumbai.polygonscan.com/address/0x08d85979eb7c04d7f339036bc87a8d850be29b92#readContract)
Можно опираться на Read Contract методы для кастомизации работы dApp'a:
- `getApproxWinAmount`
- `getCutoffDate`
- `getDecisionDate`
- `getDecisionProvider`
- `getDescription`
- `getState`
- `getTotalValueLocked`
- `getTotalVotesValue`
- `getVotes`
- `getWinToken`
- `MAX_BID`
- `owner`

##### Матики берем тут: 
https://faucet.polygon.technology/
или тут
https://mumbaifaucet.com/
Если вдруг нет сетки в воллете
https://chainlist.org/chain/80001




